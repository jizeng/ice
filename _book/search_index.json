{"index":{"version":"0.5.12","fields":[{"name":"title","boost":10},{"name":"keywords","boost":15},{"name":"body","boost":1}],"ref":"url","documentStore":{"store":{"./":["1、难以适应分片场景","2、主备切换时数据冲突","3、网络异常时无法判断插入是否成功","id","id。单靠","id。如果使用发号器，就可以在插入之前预先产生","id。如果在执行语句时发生网络中断，客户端无法知道事务是否成功，即使成功，也无法再获得产生的","id。如果碰到网络中断，可以用已经获得的","id，不同分片上会产生相同的","id，单靠","id，在完成插入后，才能得到产生的","mysql","为什么需要一个发号器","会和尚未同步的主库上的数据冲突。这样一来，即使原来的主库恢复了，也无法重新加入集群。数据修复也变成了一件非常困难的事情。引入发号器以后，备库上插入的","作为分片字段成为可能。","去尝试查询来判断之前的插入是否成功。","参考:如何做一个靠谱的发号器","和原来主库上的","在","在采用数据库分片时，如果使用数据库自增","基本介绍","就能实现关联。同时，这也使得采用","当插入记录时，如果使用数据库自增","无法唯一标示一个对象，还需要额外加上分片字段才行。如果需要将","是不会重复的。因此，未复制的新增数据和对这些新增数据的修改就不会在备库发生冲突。","用于其他对象的关联时，会麻烦很多。而采用发号器生成的是全局唯一的","集群发生主备切换时，异步复制无法确保主从完全同步。在备库开放写入后，备库上产生的自增"],"classify.html":["1、sequenc","2、timestamp",">","id","sequence，一类是基于","timestamp","分类","发号器产生的","可以分成两大类。一类是","常见分类","的。"],"scheme.html":["10bit作为机器编号","12bit作为毫秒内序列号","1、数据库auto_incr","2、类snowflake算法","41bit作为毫秒数","snowflake是twitter开源的分布式id生成算法，其核心思想为，一个long型的id：","优点：","冗余主库，避免写入单点","可用性难以保证：数据库常见架构是一主多从+读写分离，生成自增id是写请求，主库挂了就玩不转了","实现方案","常见方法","扩展性差，性能有上限：因为写入是单点，数据库主库的写性能决定id的生成性能上限，并且难以扩展","改进方法：","数据水平切分，保证各主库生成的id不重复","步长固定","由1个写库变成3个写库，每个写库设置不同的auto_increment初始值，以及相同的增长步长，以保证每个数据库生成的id是不同的（上图中库0生成0,3,6,9…，库1生成1,4,7,10，库2生成2,5,8,11…）","简单，使用数据库已有的功能","缺点：","能够保证唯一性","能够保证递增性"]},"length":3},"tokenStore":{"root":{"1":{"0":{"docs":{},"b":{"docs":{},"i":{"docs":{},"t":{"docs":{},"作":{"docs":{},"为":{"docs":{},"机":{"docs":{},"器":{"docs":{},"编":{"docs":{},"号":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}}}}}}}},"2":{"docs":{},"b":{"docs":{},"i":{"docs":{},"t":{"docs":{},"作":{"docs":{},"为":{"docs":{},"毫":{"docs":{},"秒":{"docs":{},"内":{"docs":{},"序":{"docs":{},"列":{"docs":{},"号":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}}}}}}}}}},"docs":{},"、":{"docs":{},"难":{"docs":{},"以":{"docs":{},"适":{"docs":{},"应":{"docs":{},"分":{"docs":{},"片":{"docs":{},"场":{"docs":{},"景":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}},"s":{"docs":{},"e":{"docs":{},"q":{"docs":{},"u":{"docs":{},"e":{"docs":{},"n":{"docs":{},"c":{"docs":{"classify.html":{"ref":"classify.html","tf":0.1}}}}}}}}},"数":{"docs":{},"据":{"docs":{},"库":{"docs":{},"a":{"docs":{},"u":{"docs":{},"t":{"docs":{},"o":{"docs":{},"_":{"docs":{},"i":{"docs":{},"n":{"docs":{},"c":{"docs":{},"r":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}}}}}}}}}}}},"2":{"docs":{},"、":{"docs":{},"主":{"docs":{},"备":{"docs":{},"切":{"docs":{},"换":{"docs":{},"时":{"docs":{},"数":{"docs":{},"据":{"docs":{},"冲":{"docs":{},"突":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}},"t":{"docs":{},"i":{"docs":{},"m":{"docs":{},"e":{"docs":{},"s":{"docs":{},"t":{"docs":{},"a":{"docs":{},"m":{"docs":{},"p":{"docs":{"classify.html":{"ref":"classify.html","tf":0.1}}}}}}}}}}},"类":{"docs":{},"s":{"docs":{},"n":{"docs":{},"o":{"docs":{},"w":{"docs":{},"f":{"docs":{},"l":{"docs":{},"a":{"docs":{},"k":{"docs":{},"e":{"docs":{},"算":{"docs":{},"法":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}}}}}}}}}}}},"3":{"docs":{},"、":{"docs":{},"网":{"docs":{},"络":{"docs":{},"异":{"docs":{},"常":{"docs":{},"时":{"docs":{},"无":{"docs":{},"法":{"docs":{},"判":{"docs":{},"断":{"docs":{},"插":{"docs":{},"入":{"docs":{},"是":{"docs":{},"否":{"docs":{},"成":{"docs":{},"功":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}}},"4":{"1":{"docs":{},"b":{"docs":{},"i":{"docs":{},"t":{"docs":{},"作":{"docs":{},"为":{"docs":{},"毫":{"docs":{},"秒":{"docs":{},"数":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}}}}}}},"docs":{}},"docs":{},"i":{"docs":{},"d":{"docs":{"./":{"ref":"./","tf":0.24242424242424243},"classify.html":{"ref":"classify.html","tf":0.1}},"。":{"docs":{},"单":{"docs":{},"靠":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}},"如":{"docs":{},"果":{"docs":{},"使":{"docs":{},"用":{"docs":{},"发":{"docs":{},"号":{"docs":{},"器":{"docs":{},"，":{"docs":{},"就":{"docs":{},"可":{"docs":{},"以":{"docs":{},"在":{"docs":{},"插":{"docs":{},"入":{"docs":{},"之":{"docs":{},"前":{"docs":{},"预":{"docs":{},"先":{"docs":{},"产":{"docs":{},"生":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}}}},"在":{"docs":{},"执":{"docs":{},"行":{"docs":{},"语":{"docs":{},"句":{"docs":{},"时":{"docs":{},"发":{"docs":{},"生":{"docs":{},"网":{"docs":{},"络":{"docs":{},"中":{"docs":{},"断":{"docs":{},"，":{"docs":{},"客":{"docs":{},"户":{"docs":{},"端":{"docs":{},"无":{"docs":{},"法":{"docs":{},"知":{"docs":{},"道":{"docs":{},"事":{"docs":{},"务":{"docs":{},"是":{"docs":{},"否":{"docs":{},"成":{"docs":{},"功":{"docs":{},"，":{"docs":{},"即":{"docs":{},"使":{"docs":{},"成":{"docs":{},"功":{"docs":{},"，":{"docs":{},"也":{"docs":{},"无":{"docs":{},"法":{"docs":{},"再":{"docs":{},"获":{"docs":{},"得":{"docs":{},"产":{"docs":{},"生":{"docs":{},"的":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"碰":{"docs":{},"到":{"docs":{},"网":{"docs":{},"络":{"docs":{},"中":{"docs":{},"断":{"docs":{},"，":{"docs":{},"可":{"docs":{},"以":{"docs":{},"用":{"docs":{},"已":{"docs":{},"经":{"docs":{},"获":{"docs":{},"得":{"docs":{},"的":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}}}},"，":{"docs":{},"不":{"docs":{},"同":{"docs":{},"分":{"docs":{},"片":{"docs":{},"上":{"docs":{},"会":{"docs":{},"产":{"docs":{},"生":{"docs":{},"相":{"docs":{},"同":{"docs":{},"的":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}},"单":{"docs":{},"靠":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}},"在":{"docs":{},"完":{"docs":{},"成":{"docs":{},"插":{"docs":{},"入":{"docs":{},"后":{"docs":{},"，":{"docs":{},"才":{"docs":{},"能":{"docs":{},"得":{"docs":{},"到":{"docs":{},"产":{"docs":{},"生":{"docs":{},"的":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}}},"m":{"docs":{},"y":{"docs":{},"s":{"docs":{},"q":{"docs":{},"l":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}},"为":{"docs":{},"什":{"docs":{},"么":{"docs":{},"需":{"docs":{},"要":{"docs":{},"一":{"docs":{},"个":{"docs":{},"发":{"docs":{},"号":{"docs":{},"器":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}},"会":{"docs":{},"和":{"docs":{},"尚":{"docs":{},"未":{"docs":{},"同":{"docs":{},"步":{"docs":{},"的":{"docs":{},"主":{"docs":{},"库":{"docs":{},"上":{"docs":{},"的":{"docs":{},"数":{"docs":{},"据":{"docs":{},"冲":{"docs":{},"突":{"docs":{},"。":{"docs":{},"这":{"docs":{},"样":{"docs":{},"一":{"docs":{},"来":{"docs":{},"，":{"docs":{},"即":{"docs":{},"使":{"docs":{},"原":{"docs":{},"来":{"docs":{},"的":{"docs":{},"主":{"docs":{},"库":{"docs":{},"恢":{"docs":{},"复":{"docs":{},"了":{"docs":{},"，":{"docs":{},"也":{"docs":{},"无":{"docs":{},"法":{"docs":{},"重":{"docs":{},"新":{"docs":{},"加":{"docs":{},"入":{"docs":{},"集":{"docs":{},"群":{"docs":{},"。":{"docs":{},"数":{"docs":{},"据":{"docs":{},"修":{"docs":{},"复":{"docs":{},"也":{"docs":{},"变":{"docs":{},"成":{"docs":{},"了":{"docs":{},"一":{"docs":{},"件":{"docs":{},"非":{"docs":{},"常":{"docs":{},"困":{"docs":{},"难":{"docs":{},"的":{"docs":{},"事":{"docs":{},"情":{"docs":{},"。":{"docs":{},"引":{"docs":{},"入":{"docs":{},"发":{"docs":{},"号":{"docs":{},"器":{"docs":{},"以":{"docs":{},"后":{"docs":{},"，":{"docs":{},"备":{"docs":{},"库":{"docs":{},"上":{"docs":{},"插":{"docs":{},"入":{"docs":{},"的":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"作":{"docs":{},"为":{"docs":{},"分":{"docs":{},"片":{"docs":{},"字":{"docs":{},"段":{"docs":{},"成":{"docs":{},"为":{"docs":{},"可":{"docs":{},"能":{"docs":{},"。":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}},"去":{"docs":{},"尝":{"docs":{},"试":{"docs":{},"查":{"docs":{},"询":{"docs":{},"来":{"docs":{},"判":{"docs":{},"断":{"docs":{},"之":{"docs":{},"前":{"docs":{},"的":{"docs":{},"插":{"docs":{},"入":{"docs":{},"是":{"docs":{},"否":{"docs":{},"成":{"docs":{},"功":{"docs":{},"。":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}}}},"参":{"docs":{},"考":{"docs":{},":":{"docs":{},"如":{"docs":{},"何":{"docs":{},"做":{"docs":{},"一":{"docs":{},"个":{"docs":{},"靠":{"docs":{},"谱":{"docs":{},"的":{"docs":{},"发":{"docs":{},"号":{"docs":{},"器":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}},"和":{"docs":{},"原":{"docs":{},"来":{"docs":{},"主":{"docs":{},"库":{"docs":{},"上":{"docs":{},"的":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}},"在":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}},"采":{"docs":{},"用":{"docs":{},"数":{"docs":{},"据":{"docs":{},"库":{"docs":{},"分":{"docs":{},"片":{"docs":{},"时":{"docs":{},"，":{"docs":{},"如":{"docs":{},"果":{"docs":{},"使":{"docs":{},"用":{"docs":{},"数":{"docs":{},"据":{"docs":{},"库":{"docs":{},"自":{"docs":{},"增":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}}}}},"基":{"docs":{},"本":{"docs":{},"介":{"docs":{},"绍":{"docs":{"./":{"ref":"./","tf":10}}}}}},"就":{"docs":{},"能":{"docs":{},"实":{"docs":{},"现":{"docs":{},"关":{"docs":{},"联":{"docs":{},"。":{"docs":{},"同":{"docs":{},"时":{"docs":{},"，":{"docs":{},"这":{"docs":{},"也":{"docs":{},"使":{"docs":{},"得":{"docs":{},"采":{"docs":{},"用":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}},"当":{"docs":{},"插":{"docs":{},"入":{"docs":{},"记":{"docs":{},"录":{"docs":{},"时":{"docs":{},"，":{"docs":{},"如":{"docs":{},"果":{"docs":{},"使":{"docs":{},"用":{"docs":{},"数":{"docs":{},"据":{"docs":{},"库":{"docs":{},"自":{"docs":{},"增":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}},"无":{"docs":{},"法":{"docs":{},"唯":{"docs":{},"一":{"docs":{},"标":{"docs":{},"示":{"docs":{},"一":{"docs":{},"个":{"docs":{},"对":{"docs":{},"象":{"docs":{},"，":{"docs":{},"还":{"docs":{},"需":{"docs":{},"要":{"docs":{},"额":{"docs":{},"外":{"docs":{},"加":{"docs":{},"上":{"docs":{},"分":{"docs":{},"片":{"docs":{},"字":{"docs":{},"段":{"docs":{},"才":{"docs":{},"行":{"docs":{},"。":{"docs":{},"如":{"docs":{},"果":{"docs":{},"需":{"docs":{},"要":{"docs":{},"将":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"是":{"docs":{},"不":{"docs":{},"会":{"docs":{},"重":{"docs":{},"复":{"docs":{},"的":{"docs":{},"。":{"docs":{},"因":{"docs":{},"此":{"docs":{},"，":{"docs":{},"未":{"docs":{},"复":{"docs":{},"制":{"docs":{},"的":{"docs":{},"新":{"docs":{},"增":{"docs":{},"数":{"docs":{},"据":{"docs":{},"和":{"docs":{},"对":{"docs":{},"这":{"docs":{},"些":{"docs":{},"新":{"docs":{},"增":{"docs":{},"数":{"docs":{},"据":{"docs":{},"的":{"docs":{},"修":{"docs":{},"改":{"docs":{},"就":{"docs":{},"不":{"docs":{},"会":{"docs":{},"在":{"docs":{},"备":{"docs":{},"库":{"docs":{},"发":{"docs":{},"生":{"docs":{},"冲":{"docs":{},"突":{"docs":{},"。":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"用":{"docs":{},"于":{"docs":{},"其":{"docs":{},"他":{"docs":{},"对":{"docs":{},"象":{"docs":{},"的":{"docs":{},"关":{"docs":{},"联":{"docs":{},"时":{"docs":{},"，":{"docs":{},"会":{"docs":{},"麻":{"docs":{},"烦":{"docs":{},"很":{"docs":{},"多":{"docs":{},"。":{"docs":{},"而":{"docs":{},"采":{"docs":{},"用":{"docs":{},"发":{"docs":{},"号":{"docs":{},"器":{"docs":{},"生":{"docs":{},"成":{"docs":{},"的":{"docs":{},"是":{"docs":{},"全":{"docs":{},"局":{"docs":{},"唯":{"docs":{},"一":{"docs":{},"的":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"集":{"docs":{},"群":{"docs":{},"发":{"docs":{},"生":{"docs":{},"主":{"docs":{},"备":{"docs":{},"切":{"docs":{},"换":{"docs":{},"时":{"docs":{},"，":{"docs":{},"异":{"docs":{},"步":{"docs":{},"复":{"docs":{},"制":{"docs":{},"无":{"docs":{},"法":{"docs":{},"确":{"docs":{},"保":{"docs":{},"主":{"docs":{},"从":{"docs":{},"完":{"docs":{},"全":{"docs":{},"同":{"docs":{},"步":{"docs":{},"。":{"docs":{},"在":{"docs":{},"备":{"docs":{},"库":{"docs":{},"开":{"docs":{},"放":{"docs":{},"写":{"docs":{},"入":{"docs":{},"后":{"docs":{},"，":{"docs":{},"备":{"docs":{},"库":{"docs":{},"上":{"docs":{},"产":{"docs":{},"生":{"docs":{},"的":{"docs":{},"自":{"docs":{},"增":{"docs":{"./":{"ref":"./","tf":0.030303030303030304}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},">":{"docs":{"classify.html":{"ref":"classify.html","tf":0.1}}},"s":{"docs":{},"e":{"docs":{},"q":{"docs":{},"u":{"docs":{},"e":{"docs":{},"n":{"docs":{},"c":{"docs":{},"e":{"docs":{},"，":{"docs":{},"一":{"docs":{},"类":{"docs":{},"是":{"docs":{},"基":{"docs":{},"于":{"docs":{"classify.html":{"ref":"classify.html","tf":0.1}}}}}}}}}}}}}}},"n":{"docs":{},"o":{"docs":{},"w":{"docs":{},"f":{"docs":{},"l":{"docs":{},"a":{"docs":{},"k":{"docs":{},"e":{"docs":{},"是":{"docs":{},"t":{"docs":{},"w":{"docs":{},"i":{"docs":{},"t":{"docs":{},"t":{"docs":{},"e":{"docs":{},"r":{"docs":{},"开":{"docs":{},"源":{"docs":{},"的":{"docs":{},"分":{"docs":{},"布":{"docs":{},"式":{"docs":{},"i":{"docs":{},"d":{"docs":{},"生":{"docs":{},"成":{"docs":{},"算":{"docs":{},"法":{"docs":{},"，":{"docs":{},"其":{"docs":{},"核":{"docs":{},"心":{"docs":{},"思":{"docs":{},"想":{"docs":{},"为":{"docs":{},"，":{"docs":{},"一":{"docs":{},"个":{"docs":{},"l":{"docs":{},"o":{"docs":{},"n":{"docs":{},"g":{"docs":{},"型":{"docs":{},"的":{"docs":{},"i":{"docs":{},"d":{"docs":{},"：":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"t":{"docs":{},"i":{"docs":{},"m":{"docs":{},"e":{"docs":{},"s":{"docs":{},"t":{"docs":{},"a":{"docs":{},"m":{"docs":{},"p":{"docs":{"classify.html":{"ref":"classify.html","tf":0.1}}}}}}}}}}},"分":{"docs":{},"类":{"docs":{"classify.html":{"ref":"classify.html","tf":0.1}}}},"发":{"docs":{},"号":{"docs":{},"器":{"docs":{},"产":{"docs":{},"生":{"docs":{},"的":{"docs":{"classify.html":{"ref":"classify.html","tf":0.1}}}}}}}},"可":{"docs":{},"以":{"docs":{},"分":{"docs":{},"成":{"docs":{},"两":{"docs":{},"大":{"docs":{},"类":{"docs":{},"。":{"docs":{},"一":{"docs":{},"类":{"docs":{},"是":{"docs":{"classify.html":{"ref":"classify.html","tf":0.1}}}}}}}}}}}},"用":{"docs":{},"性":{"docs":{},"难":{"docs":{},"以":{"docs":{},"保":{"docs":{},"证":{"docs":{},"：":{"docs":{},"数":{"docs":{},"据":{"docs":{},"库":{"docs":{},"常":{"docs":{},"见":{"docs":{},"架":{"docs":{},"构":{"docs":{},"是":{"docs":{},"一":{"docs":{},"主":{"docs":{},"多":{"docs":{},"从":{"docs":{},"+":{"docs":{},"读":{"docs":{},"写":{"docs":{},"分":{"docs":{},"离":{"docs":{},"，":{"docs":{},"生":{"docs":{},"成":{"docs":{},"自":{"docs":{},"增":{"docs":{},"i":{"docs":{},"d":{"docs":{},"是":{"docs":{},"写":{"docs":{},"请":{"docs":{},"求":{"docs":{},"，":{"docs":{},"主":{"docs":{},"库":{"docs":{},"挂":{"docs":{},"了":{"docs":{},"就":{"docs":{},"玩":{"docs":{},"不":{"docs":{},"转":{"docs":{},"了":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"常":{"docs":{},"见":{"docs":{},"分":{"docs":{},"类":{"docs":{"classify.html":{"ref":"classify.html","tf":10}}}},"方":{"docs":{},"法":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}},"的":{"docs":{},"。":{"docs":{"classify.html":{"ref":"classify.html","tf":0.1}}}},"优":{"docs":{},"点":{"docs":{},"：":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}},"冗":{"docs":{},"余":{"docs":{},"主":{"docs":{},"库":{"docs":{},"，":{"docs":{},"避":{"docs":{},"免":{"docs":{},"写":{"docs":{},"入":{"docs":{},"单":{"docs":{},"点":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}}}}}}}}},"实":{"docs":{},"现":{"docs":{},"方":{"docs":{},"案":{"docs":{"scheme.html":{"ref":"scheme.html","tf":10}}}}}},"扩":{"docs":{},"展":{"docs":{},"性":{"docs":{},"差":{"docs":{},"，":{"docs":{},"性":{"docs":{},"能":{"docs":{},"有":{"docs":{},"上":{"docs":{},"限":{"docs":{},"：":{"docs":{},"因":{"docs":{},"为":{"docs":{},"写":{"docs":{},"入":{"docs":{},"是":{"docs":{},"单":{"docs":{},"点":{"docs":{},"，":{"docs":{},"数":{"docs":{},"据":{"docs":{},"库":{"docs":{},"主":{"docs":{},"库":{"docs":{},"的":{"docs":{},"写":{"docs":{},"性":{"docs":{},"能":{"docs":{},"决":{"docs":{},"定":{"docs":{},"i":{"docs":{},"d":{"docs":{},"的":{"docs":{},"生":{"docs":{},"成":{"docs":{},"性":{"docs":{},"能":{"docs":{},"上":{"docs":{},"限":{"docs":{},"，":{"docs":{},"并":{"docs":{},"且":{"docs":{},"难":{"docs":{},"以":{"docs":{},"扩":{"docs":{},"展":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"改":{"docs":{},"进":{"docs":{},"方":{"docs":{},"法":{"docs":{},"：":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}}},"数":{"docs":{},"据":{"docs":{},"水":{"docs":{},"平":{"docs":{},"切":{"docs":{},"分":{"docs":{},"，":{"docs":{},"保":{"docs":{},"证":{"docs":{},"各":{"docs":{},"主":{"docs":{},"库":{"docs":{},"生":{"docs":{},"成":{"docs":{},"的":{"docs":{},"i":{"docs":{},"d":{"docs":{},"不":{"docs":{},"重":{"docs":{},"复":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}}}}}}}}}}}}}}}}}},"步":{"docs":{},"长":{"docs":{},"固":{"docs":{},"定":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}},"由":{"1":{"docs":{},"个":{"docs":{},"写":{"docs":{},"库":{"docs":{},"变":{"docs":{},"成":{"3":{"docs":{},"个":{"docs":{},"写":{"docs":{},"库":{"docs":{},"，":{"docs":{},"每":{"docs":{},"个":{"docs":{},"写":{"docs":{},"库":{"docs":{},"设":{"docs":{},"置":{"docs":{},"不":{"docs":{},"同":{"docs":{},"的":{"docs":{},"a":{"docs":{},"u":{"docs":{},"t":{"docs":{},"o":{"docs":{},"_":{"docs":{},"i":{"docs":{},"n":{"docs":{},"c":{"docs":{},"r":{"docs":{},"e":{"docs":{},"m":{"docs":{},"e":{"docs":{},"n":{"docs":{},"t":{"docs":{},"初":{"docs":{},"始":{"docs":{},"值":{"docs":{},"，":{"docs":{},"以":{"docs":{},"及":{"docs":{},"相":{"docs":{},"同":{"docs":{},"的":{"docs":{},"增":{"docs":{},"长":{"docs":{},"步":{"docs":{},"长":{"docs":{},"，":{"docs":{},"以":{"docs":{},"保":{"docs":{},"证":{"docs":{},"每":{"docs":{},"个":{"docs":{},"数":{"docs":{},"据":{"docs":{},"库":{"docs":{},"生":{"docs":{},"成":{"docs":{},"的":{"docs":{},"i":{"docs":{},"d":{"docs":{},"是":{"docs":{},"不":{"docs":{},"同":{"docs":{},"的":{"docs":{},"（":{"docs":{},"上":{"docs":{},"图":{"docs":{},"中":{"docs":{},"库":{"0":{"docs":{},"生":{"docs":{},"成":{"0":{"docs":{},",":{"3":{"docs":{},",":{"6":{"docs":{},",":{"9":{"docs":{},"…":{"docs":{},"，":{"docs":{},"库":{"1":{"docs":{},"生":{"docs":{},"成":{"1":{"docs":{},",":{"4":{"docs":{},",":{"7":{"docs":{},",":{"1":{"0":{"docs":{},"，":{"docs":{},"库":{"2":{"docs":{},"生":{"docs":{},"成":{"2":{"docs":{},",":{"5":{"docs":{},",":{"8":{"docs":{},",":{"1":{"1":{"docs":{},"…":{"docs":{},"）":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}},"docs":{}},"docs":{}}},"docs":{}}},"docs":{}}},"docs":{}}}},"docs":{}}}},"docs":{}},"docs":{}}},"docs":{}}},"docs":{}}},"docs":{}}}},"docs":{}}}}},"docs":{}}},"docs":{}}},"docs":{}}},"docs":{}}}},"docs":{}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}},"docs":{}}}}}}},"docs":{}},"简":{"docs":{},"单":{"docs":{},"，":{"docs":{},"使":{"docs":{},"用":{"docs":{},"数":{"docs":{},"据":{"docs":{},"库":{"docs":{},"已":{"docs":{},"有":{"docs":{},"的":{"docs":{},"功":{"docs":{},"能":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}}}}}}}}}}},"缺":{"docs":{},"点":{"docs":{},"：":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}},"能":{"docs":{},"够":{"docs":{},"保":{"docs":{},"证":{"docs":{},"唯":{"docs":{},"一":{"docs":{},"性":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}},"递":{"docs":{},"增":{"docs":{},"性":{"docs":{"scheme.html":{"ref":"scheme.html","tf":0.05263157894736842}}}}}}}}}},"length":58},"corpusTokens":["10bit作为机器编号","12bit作为毫秒内序列号","1、sequenc","1、数据库auto_incr","1、难以适应分片场景","2、timestamp","2、主备切换时数据冲突","2、类snowflake算法","3、网络异常时无法判断插入是否成功","41bit作为毫秒数",">","id","id。单靠","id。如果使用发号器，就可以在插入之前预先产生","id。如果在执行语句时发生网络中断，客户端无法知道事务是否成功，即使成功，也无法再获得产生的","id。如果碰到网络中断，可以用已经获得的","id，不同分片上会产生相同的","id，单靠","id，在完成插入后，才能得到产生的","mysql","sequence，一类是基于","snowflake是twitter开源的分布式id生成算法，其核心思想为，一个long型的id：","timestamp","为什么需要一个发号器","优点：","会和尚未同步的主库上的数据冲突。这样一来，即使原来的主库恢复了，也无法重新加入集群。数据修复也变成了一件非常困难的事情。引入发号器以后，备库上插入的","作为分片字段成为可能。","冗余主库，避免写入单点","分类","去尝试查询来判断之前的插入是否成功。","参考:如何做一个靠谱的发号器","发号器产生的","可以分成两大类。一类是","可用性难以保证：数据库常见架构是一主多从+读写分离，生成自增id是写请求，主库挂了就玩不转了","和原来主库上的","在","在采用数据库分片时，如果使用数据库自增","基本介绍","实现方案","就能实现关联。同时，这也使得采用","常见分类","常见方法","当插入记录时，如果使用数据库自增","扩展性差，性能有上限：因为写入是单点，数据库主库的写性能决定id的生成性能上限，并且难以扩展","改进方法：","数据水平切分，保证各主库生成的id不重复","无法唯一标示一个对象，还需要额外加上分片字段才行。如果需要将","是不会重复的。因此，未复制的新增数据和对这些新增数据的修改就不会在备库发生冲突。","步长固定","用于其他对象的关联时，会麻烦很多。而采用发号器生成的是全局唯一的","由1个写库变成3个写库，每个写库设置不同的auto_increment初始值，以及相同的增长步长，以保证每个数据库生成的id是不同的（上图中库0生成0,3,6,9…，库1生成1,4,7,10，库2生成2,5,8,11…）","的。","简单，使用数据库已有的功能","缺点：","能够保证唯一性","能够保证递增性","集群发生主备切换时，异步复制无法确保主从完全同步。在备库开放写入后，备库上产生的自增"],"pipeline":["stopWordFilter","stemmer"]},"store":{"./":{"url":"./","title":"基本介绍","keywords":"","body":"为什么需要一个发号器\n参考:如何做一个靠谱的发号器\n  \n1、难以适应分片场景  \n\n在采用数据库分片时，如果使用数据库自增 ID，不同分片上会产生相同的 ID。单靠 ID 无法唯一标示一个对象，还需要额外加上分片字段才行。如果需要将 ID 用于其他对象的关联时，会麻烦很多。而采用发号器生成的是全局唯一的 ID，单靠 ID 就能实现关联。同时，这也使得采用 ID 作为分片字段成为可能。  \n\n2、主备切换时数据冲突  \n\n在 MySQL 集群发生主备切换时，异步复制无法确保主从完全同步。在备库开放写入后，备库上产生的自增 ID 会和尚未同步的主库上的数据冲突。这样一来，即使原来的主库恢复了，也无法重新加入集群。数据修复也变成了一件非常困难的事情。引入发号器以后，备库上插入的 ID 和原来主库上的 ID 是不会重复的。因此，未复制的新增数据和对这些新增数据的修改就不会在备库发生冲突。\n\n3、网络异常时无法判断插入是否成功\n\n当插入记录时，如果使用数据库自增 ID，在完成插入后，才能得到产生的 ID。如果在执行语句时发生网络中断，客户端无法知道事务是否成功，即使成功，也无法再获得产生的 ID。如果使用发号器，就可以在插入之前预先产生 ID。如果碰到网络中断，可以用已经获得的 ID 去尝试查询来判断之前的插入是否成功。\n\n"},"classify.html":{"url":"classify.html","title":"常见分类","keywords":"","body":"分类\n发号器产生的 ID 可以分成两大类。一类是 Sequence，一类是基于 Timestamp 的。  \n1、Sequence\n>\n2、Timestamp\n"},"scheme.html":{"url":"scheme.html","title":"实现方案","keywords":"","body":"常见方法\n1、数据库auto_increment\n优点：  \n\n简单，使用数据库已有的功能\n\n能够保证唯一性\n\n能够保证递增性\n\n步长固定\n\n\n缺点：\n\n可用性难以保证：数据库常见架构是一主多从+读写分离，生成自增ID是写请求，主库挂了就玩不转了\n\n扩展性差，性能有上限：因为写入是单点，数据库主库的写性能决定ID的生成性能上限，并且难以扩展  \n\n\n改进方法：\n\n冗余主库，避免写入单点\n\n数据水平切分，保证各主库生成的ID不重复  \n\n\n\n由1个写库变成3个写库，每个写库设置不同的auto_increment初始值，以及相同的增长步长，以保证每个数据库生成的ID是不同的（上图中库0生成0,3,6,9…，库1生成1,4,7,10，库2生成2,5,8,11…）\n\n2、类snowflake算法\n\nsnowflake是twitter开源的分布式ID生成算法，其核心思想为，一个long型的ID：\n\n\n41bit作为毫秒数\n\n10bit作为机器编号\n\n12bit作为毫秒内序列号\n\n\n"}}}